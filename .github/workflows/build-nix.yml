on:
  workflow_dispatch: ~
  push:
    paths:
      - 'NixOS/**.nix'
      - '.github/workflows/build-nix.yml'

jobs:
  build-nix:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: cachix/install-nix-action@v25
        with:
          nix_path: nixpkgs=channel:nixos-unstable
      - uses: cachix/cachix-action@v14
        with:
          name: skyenet
          authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
      - name: Build mlton
        run: |
          nix build ./NixOS#mlton
      - name: Build Porkbun-DDNS
        run: |
          nix build ./NixOS#porkbun-ddns
      - name: Build anemoi
        run: |
          nix build ./NixOS#anemoi
      - name: Build Tube Archivist
        run: |
          nix build ./NixOS#tubearchivist
      - name: Build Browsertrix Crawler
        run: |
          nix build ./NixOS#browsertrix-crawler
      # - name: Build SML/NJ
      #   run: |
      #     nix build ./NixOS#smlnj-dev
